<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Calculadora Web</title>
    <link rel="stylesheet" href="/static/css/style.css">
  </head>
  <body>
    <div class="calculator">
      <input id="display" class="display" readonly />
      <div class="keys">
        <button data-val="7">7</button>
        <button data-val="8">8</button>
        <button data-val="9">9</button>
        <button data-val="/">/</button>

        <button data-val="4">4</button>
        <button data-val="5">5</button>
        <button data-val="6">6</button>
        <button data-val="*">*</button>

        <button data-val="1">1</button>
        <button data-val="2">2</button>
        <button data-val="3">3</button>
        <button data-val="-">-</button>

        <button data-val="0">0</button>
        <button data-val=".">.</button>
        <button id="equals">=</button>
        <button data-val="+">+</button>

        <button id="clear">C</button>
        <button id="back">âŒ«</button>
      </div>
    </div>

    <script>
      const display = document.getElementById('display');
      document.querySelectorAll('button[data-val]').forEach(b => {
        b.addEventListener('click', () => {
          display.value += b.getAttribute('data-val');
        });
      });

      document.getElementById('clear').addEventListener('click', () => display.value = '');
      document.getElementById('back').addEventListener('click', () => display.value = display.value.slice(0, -1));

      async function evaluateExpr() {
        const expr = display.value;
        try {
          const form = new FormData();
          form.append('expr', expr);
          const res = await fetch('/eval/', { method: 'POST', body: form });
          const json = await res.json();
          if (res.ok) {
            display.value = json.result;
          } else {
            display.value = 'Error';
            setTimeout(() => display.value = '', 800);
          }
        } catch (e) {
          display.value = 'Error';
        }
      }

      document.getElementById('equals').addEventListener('click', evaluateExpr);
      window.addEventListener('keydown', (e) => {
        if ((e.key >= '0' && e.key <= '9') || '+-*/.()'.includes(e.key)) {
          display.value += e.key;
        } else if (e.key === 'Enter') {
          evaluateExpr();
        } else if (e.key === 'Backspace') {
          display.value = display.value.slice(0, -1);
        } else if (e.key === 'Escape') {
          display.value = '';
        }
      });
    </script>
  </body>
</html>
